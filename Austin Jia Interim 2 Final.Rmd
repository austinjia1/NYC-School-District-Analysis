---
title: "Individual CS"
author: "Austin Jia"
date: "12/16/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include = FALSE}
# Installing packages
pkgTest <- function(x) {
  if (!require(x,character.only = TRUE)) {
    install.packages(x,dep=TRUE)
  }
}
pkgs <- c("jsonlite", "dplyr", "rvest", "purrr", "ggplot2", "gganimate", "ggthemes", "lubridate", "zoo", "shiny", "stringr", "mice", "VIM", "parallel", "corrplot", "MASS", "caTools", "nnet", "randomForest", "pROC", "caret", "ggpubr", "shiny", "glmnet", "RSocrata", "ggcorrplot", "rsconnect", "pmlr", "e1071")
for (pkg in pkgs) {
  pkgTest(pkg)
}
```

```{r, include=FALSE}
library(jsonlite)
library(dplyr)
library(rvest)
library(purrr)
library(ggplot2)
library(gganimate)
library(ggthemes)
library(lubridate)
library(zoo)
library(shiny)
library(stringr)
library(mice)
library(VIM)
library(parallel)
library(corrplot)
library(MASS)
library(caTools)
library(nnet)
library(randomForest)
library(pROC)
library(caret)
library(ggpubr)
library(shiny)
library(glmnet)
library(RSocrata)
library(ggcorrplot)
library(rsconnect)
library(e1071)
```

### Executive Summary

My project goal is to identify factors that most dramatically affect school performance in NYC boroughs for the purpose of education policymakers. I applied several variations of classifiers to analyze data from 485 NYC schools obtained from NYC Open Data. My results demonstrate that policymakers should shift their focus away from community ties and teacher approval which both actually harm school performance and toward incentivizing attendance rate and building rigorous curriculum, which have the largest positive impact on school performance. 

### 1. Introduction

In 2016, the Institute for State and Local Governance found that NYC school systems continue to be characterized by vast inequalities. On one hand, schools like Stuyvescant HS sends droves of students into the Ivy Leagues, yet schools like August Martin HS has hundreds of empty seats. This inequality motivates my research question: what are some factors that contribute to student achievement rates in NYC High Schools that policymakers should target?

### 2. Data

I extracted data from 485 NYC High Schools from NYC Open Data: https://data.cityofnewyork.us/Education/2016-2017-School-Quality-Report-Results-for-High-S/ewhs-k7um/data. My variable of interest is the NYC Student Achievement Rating (SAR), categorized into buckets of Not Meeting, Approaching, Meeting, and Exceeding a Target. My predictors can be grouped into to broad buckets: student composition (i.e. race/financial situation) and school-specific metrics (i.e. teacher/curriculum rating). 


```{r, include = FALSE}
data <- read.socrata(
  "https://data.cityofnewyork.us/resource/ewhs-k7um.json",
  app_token = "6xxqTZUbdXq2WlnUEBkACtxEH",
  email     = "alj47@duke.edu",
  password  = "Dukeletmein123!"
)
```

```{r, include = FALSE}
#Renaming variable names
data = data %>% 
  rename(
    Student.Achievement.Rating = student_achievement_rating,
    Instruction.Rating = rigorous_instruction_rating,
    Teachers.Rating = collaborative_teachers_rating,
    Leadership.Rating = effective_school_leadership,
    Community.Ties.Rating = strong_family_community_ties,
    Instruction.Rating.pct = rigorous_instruction_percent,
    Teachers.Rating.pct = collaborative_teachers_percent,
    Supportive.Environment.pct = supportive_environment_percent,
    Leadership.Rating.pct = effective_school_leadership_1,
    Community.Ties.Rating.pct = strong_family_community_ties_1,
    Challenging.Curriculum.qr = quality_review_how_interesting,
    Effective.Teaching.qr = quality_review_how_effective,
    School.Assess.qr = quality_review_how_well_does,
    Expectations.Communicated.qr = quality_review_how_clearly,
    Teachers.Cooperation.qr = quality_review_how_well_do,
    Safe.Inclusive.qr = quality_review_how_safe_and,
    Resource.Allocation.qr = quality_review_how_well_does_1,
    Meet.Goals.qr = quality_review_how_well_does_2,
    Teacher.Development.qr = quality_review_how_thoughtful,
    Decisions.Evaluated.qr = quality_review_how_well_are,
    Review.Dates.qr = quality_review_dates_of_review,
    ELA.Proficiency = average_grade_8_english,
    Math.Proficiency = average_grade_8_math,
    Principal.Experience.yrs = years_of_principal_experience, 
    Teachers.3yrs.Experience = percent_of_teachers_with,
    Students.Chronically.Absent = percent_of_students
    )

#More Data Renaming

data = data %>% 
  rename(
    Enrollment = enrollment,
    Trust...Percent.Positive = trust_percent_positive,
    Percent.Students.with.Disabilities = percent_students_with,
    Economic.Need.Index = economic_need_index,
    Percent.Asian = percent_asian,
    Percent.Hispanic = percent_hispanic,
    Student.Attendance.Rate = student_attendance_rate,
    Percent.English.Language.Learners = percent_english_language,
    Percent.Self.Contained = percent_self_contained,
    Percent.Overage..Undercredited = percent_overage_undercredited,
    Percent.Black = percent_black,
    Percent.White = percent_white,
    Teacher.Attendance.Rate = teacher_attendance_rate
    )

#Replacing blank levels with NAs
data <- data %>% mutate_if(is.factor, list(~factor(replace(., .=="", NA))))
```

### 2a. Data Wrangling and Imputation 

```{r, include = FALSE}
# Response Variable
data$Student.Achievement.Rating <- factor(data$Student.Achievement.Rating,levels = c("Not Meeting Target", "Approaching Target", "Meeting Target", "Exceeding Target", "NA"))

p_sar_old = ggplot(data, aes(factor(Student.Achievement.Rating),fill = Student.Achievement.Rating)) +
geom_bar(stat="count", position = "dodge") + 
scale_fill_brewer(palette = "Set1") + ggtitle("SAR Distribution") + labs(fill = "Target Category") + xlab("SAR Categories") + theme(
  axis.text.x = element_blank(),
  axis.text.y = element_blank(),
  axis.ticks = element_blank()) + theme(legend.position="none")

data.multi = data

#Combining Factor Levels
levels(data$Student.Achievement.Rating) <- list("Not Meeting Target"=c("Not Meeting Target", "Approaching Target"), "Meeting Target"=c("Meeting Target", "Exceeding Target"))
```

```{r, include=FALSE}
#Explanatory Variables
data$Enrollment = as.numeric(data$Enrollment)
data$Instruction.Rating.pct = as.numeric(data$Instruction.Rating.pct)
data$Teachers.Rating.pct = as.numeric(data$Teachers.Rating.pct)
data$Supportive.Environment.pct = as.numeric(data$Supportive.Environment.pct)
data$Leadership.Rating.pct = as.numeric(data$Leadership.Rating.pct)
data$Community.Ties.Rating.pct = as.numeric(data$Community.Ties.Rating.pct)
data$Trust...Percent.Positive = as.numeric(data$Trust...Percent.Positive)
data$ELA.Proficiency = as.numeric(data$Math.Proficiency)
data$Percent.English.Language.Learners = as.numeric(data$Percent.English.Language.Learners)
data$Percent.Students.with.Disabilities = as.numeric(data$Percent.Students.with.Disabilities)
data$Percent.Self.Contained = as.numeric(data$Percent.Self.Contained)
data$Economic.Need.Index = as.numeric(data$Economic.Need.Index)
data$Percent.Overage..Undercredited = as.numeric(data$Percent.Overage..Undercredited)
data$percent_in_temp_housing = as.numeric(data$percent_in_temp_housing)
data$percent_hra_eligible = as.numeric(data$percent_hra_eligible)
data$Percent.Asian = as.numeric(data$Percent.Asian)
data$Percent.Black = as.numeric(data$Percent.Black)
data$Percent.Hispanic = as.numeric(data$Percent.Hispanic)
data$Principal.Experience.yrs = as.numeric(data$Principal.Experience.yrs)
data$Teachers.3yrs.Experience = as.numeric(data$Teachers.3yrs.Experience)
data$Student.Attendance.Rate = as.numeric(data$Student.Attendance.Rate)
data$Students.Chronically.Absent = as.numeric(data$Students.Chronically.Absent)
data$Student.Attendance.Rate = as.numeric(data$Student.Attendance.Rate)
data$Students.Chronically.Absent = as.numeric(data$Students.Chronically.Absent)
data$Teacher.Attendance.Rate = as.numeric(data$Teacher.Attendance.Rate)
data$Percent.White = as.numeric(data$Percent.White)


#Collinearity Matrix
data_numeric = data[, purrr::map_lgl(data, is.numeric)]
corrthingythingy = corrplot(cor(data_numeric, use="pairwise.complete.obs"), method = "circle", tl.cex=0.5)

#GGplot correlation
corrthing <- round(cor(data_numeric), 1)
corrthingy = ggcorrplot(corrthing, tl.cex = 5)

#Removing Covariates
redundant_cols = c("Instruction.Rating", "Supportive.Environment.Rating", "Community.Ties.Rating", "Teachers.Rating", "Leadership.Rating", "Trust.Rating", "dbn", "percent_hra_eligible", "Effective.Teaching.qr", "Expectations.Communicated.qr", "Safe.Inclusive.qr", "Meet.Goals.qr", "Decisions.Evaluated.qr", "Challenging.Curriculum.qr", "School.Assess.qr", "Teachers.Cooperation.qr", "Resource.Allocation.qr", "Teacher.Development.qr", "Review.Dates.qr", "Students.Chronically.Absent", "percent_in_temp_housing", "school_type", "ELA.Proficiency", "Math.Proficiency", "school_name", "supportive_environment_rating", "trust_rating")
data = data[ , -which(names(data) %in% redundant_cols)]

ggarrange(p_sar_old, corrthingy, ncol = 2)
```

Before embarking on this project, I spoke to a connection who is an assistant at the NYC Department of Education. He shared with me that best practice is to allocate their budget to schools that fall below a binary threshold. Thus, I merged the four response categories into a binary "Not Meeting Target" and "Meeting Target" to tailor my analysis toward what would be most informative to practitioners in the field. 

I decided to remove a host of covariates for a couple reasons. First, I removed several correlated rating metrics and economic proxies to address collinearity and reduce variance. Second, I removed all the Quality Review covariates because (1) the data dictionary does not define what constitutes such subjective evaluation metrics, and (2) these metrics are likely highly inconsistent from school to school. I removed these covariates instead of just excluding them from the model to improve MICE runtime.

```{r, include = FALSE}
sum(is.na(data)) / (dim(data)[1] * dim(data)[2])
nrow(data[complete.cases(data), ])
nrow(data[complete.cases(data), ])/nrow(data)
```

```{r, include=FALSE}
missing.prop <- apply(data, MARGIN = 2, FUN = function(x) { sum(is.na(x)) })
missing.prop <- missing.prop / dim(data)[1]
missing.prop <- data.frame("prop" = missing.prop,
                           "var" = names(data))
ggplot(missing.prop, aes(x = reorder(var, -prop), y = prop)) + 
  geom_bar(stat = "identity") +
  theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5)) + 
  geom_col(colour = "black", fill = "#FF6666") + 
  xlab("Covariate") + 
  ylab("Proportion Missing") +
  ggtitle("The Proportion of Missing Values for Each Covariate")
```

```{r, include=FALSE}
#Not MCAR
marginplot(data[, c("Teacher.Attendance.Rate", "Teachers.3yrs.Experience")], col = mdc(1:2), cex.numbers = 1.2, pch = 19)
```

```{r, include=FALSE}
#Mean and Mode Imputation 

calc.mode <- function(x) {
  ux <- na.omit(unique(x))
  ux[which.max(tabulate(match(x, ux)))]
}
impute_covariates <- as.character(missing.prop[(missing.prop$prop <= 0.05) & (missing.prop$prop > 0), ]$var)
data2 <- as.data.frame(data)
for (var in impute_covariates) {
  print(var)
  if (is.factor(data2[[var]])) {
    data2[is.na(data2[[var]]), var] <- calc.mode(data2[[var]])
  } else {
    data2[is.na(data[[var]]), var] <- mean(data[[var]], na.rm = TRUE)
  }
}
```

```{r, include=FALSE}
#Mice
init = mice(data2, maxit=0) 
meth = init$method
predM = init$predictorMatrix
meth[c("Student.Achievement.Rating")]="logreg" 
data3 <- mice(data2, m=4, method=meth, predictorMatrix=predM, maxit = 5)

data5 <- complete(data3)
```

Our data is missing 2% of its values in such a way that only 84% of our observations (406 schools) have complete information. Given that my sample size is already quite limited and my margin plots indicate that the covarites are not MCAR, I opted for 4 MICE-imputed datasets over complete case analysis.

### 3. EDA

From the first EDA plot, we can see that around 40% of NYC high schools are not meeting standards. School performance seems to suffer as the African American, financially disadvantaged, and English Language Learner population increases. On the other hand, school performance seems to be helped by higher student attendance rates and higher ratings on subjective metrics such as the quality of that school's environment, curriculum, and teachers.  

```{r, echo = FALSE}
#Response Variable
p_sar = ggplot(data5, aes(factor(Student.Achievement.Rating),fill = Student.Achievement.Rating)) +
geom_bar(stat="count", position = "dodge") + 
scale_fill_brewer(palette = "Set1") + ggtitle("Student Achievement Rating Distribution") + xlab("Student Achievement Rating") + labs(fill = "Target Category") + theme(axis.text.x=element_text(angle=45, hjust=1))

#Enrollment
p_enrollment = ggplot(data5,aes(x=Enrollment,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Enrollment[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Enrollment[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Number of Students")+
  ggtitle("Distribution of Enrollment vs. SAR")+
  theme_classic() + labs(fill = "Student Achievement Rating")

#Racial Breakdown
p_asian = ggplot(data5,aes(x=Percent.Asian,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Percent.Asian[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Percent.Asian[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Percent Asian")+
  ggtitle("Distribution of Percentage Asian vs. SAR")+
  theme_classic() + labs(fill = "Student Achievement Rating")

p_hispanic = ggplot(data5,aes(x=Percent.Hispanic,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Percent.Hispanic[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Percent.Hispanic[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Percent Hispanic")+
  ggtitle("Distribution of Percentage Hispanic vs. SAR")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_black = ggplot(data5,aes(x=Percent.Black,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Percent.Black[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Percent.Black[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Percent Black")+
  ggtitle("Distribution of Percentage Black vs. SAR")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_white = ggplot(data5,aes(x=Percent.White,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Percent.White[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Percent.White[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Percent White")+
  ggtitle("Distribution of Percentage White vs. SAR")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

#Faculty 
p_principal_exp = ggplot(data5,aes(x=Principal.Experience.yrs,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Principal.Experience.yrs[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Principal.Experience.yrs[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Years of Principal Experience")+
  ggtitle("Distribution of Principal Experience vs. SAR")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_teacher_exp = ggplot(data5,aes(x=Teachers.3yrs.Experience,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Teachers.3yrs.Experience[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Teachers.3yrs.Experience[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Teacher Experience (% More than 3 yrs)")+
  ggtitle("Distribution of Teacher Experience vs. SAR")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_selfcontained = ggplot(data5,aes(x=Percent.Self.Contained,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Percent.Self.Contained[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Percent.Self.Contained[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Percent Self-Contained Classrooms")+
  ggtitle("Distribution of Self-Contained Classrooms vs. SAR")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_teacherattendance = ggplot(data5,aes(x=Teacher.Attendance.Rate,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Teacher.Attendance.Rate[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Teacher.Attendance.Rate[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Teacher Attendance Rate")+
  ggtitle("Distribution of Teacher Attendance Rate vs. SAR")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

#Student Composition
p_econ = ggplot(data5,aes(x=Economic.Need.Index,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Economic.Need.Index[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Economic.Need.Index[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Economic Need Index")+
  ggtitle("Distribution of Economic Need Index vs. SAR")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_esl = ggplot(data5,aes(x=Percent.English.Language.Learners,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Percent.English.Language.Learners[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Percent.English.Language.Learners[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Percent English Language Learners")+
  ggtitle("Distribution of English Language Learners vs. SAR")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_swd = ggplot(data5,aes(x=Percent.Students.with.Disabilities,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Percent.Students.with.Disabilities[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Percent.Students.with.Disabilities[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "% Students with Disabilities")+
  ggtitle("Distribution of Students with Disabilities vs. SAR")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_studentattendance = ggplot(data5,aes(x=Student.Attendance.Rate,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Student.Attendance.Rate[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Student.Attendance.Rate[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Student Attendance Rate")+
  ggtitle("Distribution of Student Attendance Rate vs. SAR")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_undercredited = ggplot(data5,aes(x=Percent.Overage..Undercredited,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Percent.Overage..Undercredited[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Percent.Overage..Undercredited[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Percent Undercredited")+
  ggtitle("Distribution of Undercredited Students vs. SAR")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

#Ratings
p_instruction_rating = ggplot(data5,aes(x=Instruction.Rating.pct,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Instruction.Rating.pct[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Instruction.Rating.pct[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Percent Approval of Instruction Rating")+
  ggtitle("Distribution of Instruction Rating Approval vs. SAR")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_teachers = ggplot(data5,aes(x=Teachers.Rating.pct,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Teachers.Rating.pct[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Teachers.Rating.pct[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Percent Approval of Teacher Rating")+
  ggtitle("Distribution of Teacher Rating Approval vs. SAR")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_supportive = ggplot(data5,aes(x=Supportive.Environment.pct,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Supportive.Environment.pct[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Supportive.Environment.pct[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Percent Approval of Supportive Environment")+
  ggtitle("Distribution of Supportive Environment Rating vs. SAR")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_leadership = ggplot(data5,aes(x=Leadership.Rating.pct,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Leadership.Rating.pct[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Leadership.Rating.pct[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Percent Approval of Leadership Rating")+
  ggtitle("Distribution of Leadership Rating vs. SAR")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_community = ggplot(data5,aes(x=Community.Ties.Rating.pct,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Community.Ties.Rating.pct[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Community.Ties.Rating.pct[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Percent Approval of Community Ties")+
  ggtitle("Distribution of Community Ties Rating vs. SAR")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_trust = ggplot(data5,aes(x=Trust...Percent.Positive,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Trust...Percent.Positive[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Trust...Percent.Positive[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Percent Approval of Trust")+
  ggtitle("Distribution of Trust Rating vs. SAR")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

#Knit Plots
p_black_eda = ggplot(data5,aes(x=Percent.Black,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Percent.Black[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Percent.Black[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Percent Black")+
  ggtitle("Percent Black")+
  theme(legend.position="none")

p_white_eda = ggplot(data5,aes(x=Percent.White,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Percent.White[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Percent.White[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Percent White")+
  ggtitle("Percent White")+
  theme(legend.position="none")

p_econ_eda = ggplot(data5,aes(x=Economic.Need.Index,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Economic.Need.Index[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Economic.Need.Index[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Economic Need")+
  ggtitle("Economic Need Index")+
  theme(legend.position="none")

p_studentattendance_eda = ggplot(data5,aes(x=Student.Attendance.Rate,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Student.Attendance.Rate[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Student.Attendance.Rate[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Student Attendance")+
  ggtitle("Student Attendance Rate")+
  theme(legend.position="none")

p_instruction_rating_eda = ggplot(data5,aes(x=Instruction.Rating.pct,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Instruction.Rating.pct[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Instruction.Rating.pct[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Percent Approval")+
  ggtitle("Instruction Quality")+
  theme(legend.position="none")

p_supportive_eda = ggplot(data5,aes(x=Supportive.Environment.pct,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Supportive.Environment.pct[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Supportive.Environment.pct[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Percent Approval")+
  ggtitle("Supportive Environment") +
  theme(legend.position="none") 

p_esl_eda = ggplot(data5,aes(x=Percent.English.Language.Learners,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Percent.English.Language.Learners[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Percent.English.Language.Learners[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Percent ELL")+
  ggtitle("ELL Students")+
  theme(legend.position="none")

p_teachers_eda = ggplot(data5,aes(x=Teachers.Rating.pct,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Teachers.Rating.pct[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Teachers.Rating.pct[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Percent Approval")+
  ggtitle("Teacher Quality")+
  theme(legend.position="none") 

data_interim = data5
levels(data_interim$Student.Achievement.Rating) <- list("Not Meeting"=c("Not Meeting Target"), "Meeting"=c("Meeting Target"))


p_sar_eda = ggplot(data_interim, aes(factor(Student.Achievement.Rating),fill = Student.Achievement.Rating)) +
geom_bar(stat="count", position = "dodge") + 
scale_fill_brewer(palette = "Set1") + ggtitle("Student Achievement") + xlab("SAR") + theme(axis.text.x=element_text(angle=0, hjust=1)) + theme(legend.position="none")

ggarrange(p_sar_eda, p_black_eda, p_white_eda, p_econ_eda, p_esl_eda, p_studentattendance_eda, p_supportive_eda, p_instruction_rating_eda, p_teachers_eda, nrow = 3, ncol = 3)
```

### 4. Statistical Analysis 

I tried six models: full logit model, a logit model with AIC backwards-stepwise selection, Ridge, LASSO, Random Forest with 100 trees, and SVM with Radias Basis Function.

```{r, include = FALSE}
# Split into Training and Testing
set.seed(12)
sample = sample.split(data5, SplitRatio = .75)
train = subset(data5, sample == TRUE)
test  = subset(data5, sample == FALSE)
```

```{r, include = FALSE}
set.seed(6345)
#Full Model
glm.full = glm(Student.Achievement.Rating ~., data = train, family = binomial)
glm.full.coef = coef(glm.full)

#AIC
glm.aic = step(glm.full,direction="backward", data=train, cluster.seed = 6)
glm.aic.coef = coef(glm.aic)

#Ridge and Lasso
X.train = train
X.train$Student.Achievement.Rating = NULL
X.train$School.Name = NULL
y.train = train$Student.Achievement.Rating
x.train = model.matrix( ~ ., X.train)

#Ridge
set.seed(15)
cv.out <- cv.glmnet(x.train, y.train, alpha = 0, family = "binomial")
bestlamridge <- cv.out$lambda.min
bestlamridge

glm.ridge <-glmnet(x = x.train, y = y.train, alpha = 0, lambda = bestlamridge, family = "binomial" )
glm.ridge.coef = coef(glm.ridge)

#Lasso
set.seed(15)
cv.out <- cv.glmnet(x.train, y.train, alpha = 1, family = "binomial")
bestlamlasso <- cv.out$lambda.min
bestlamlasso
glm.lasso <-glmnet(x = x.train, y = y.train, alpha = 1, lambda = bestlamlasso, family = "binomial" )
glm.lasso.coef = coef(glm.lasso)

# Random Forest
rf <- randomForest(Student.Achievement.Rating ~ ., data = train, ntree = 100, 
    importance = TRUE)
summary(rf)
varImpPlot(rf)
```

```{r, include = FALSE}
#Predictions on Validation Set and Confusion Matrices
set.seed(1346)

# Logistic Full Model
glm.full.prob <- predict(glm.full, test, type = "response")
glm.full.pred <- rep("Not Meeting Target", 138)
glm.full.pred[glm.full.prob > 0.5] <- "Meeting Target"
cm.full = table(glm.full.pred, test$Student.Achievement.Rating)
accuracy.full = mean(glm.full.pred == test$Student.Achievement.Rating)
mce.full = mean(glm.full.pred != test$Student.Achievement.Rating)

# Logistic AIC
glm.aic.prob <- predict(glm.aic, test, type = "response")
glm.aic.pred <- rep("Not Meeting Target", 138)
glm.aic.pred[glm.aic.prob > 0.5] <- "Meeting Target"
cm.aic = table(glm.full.pred,test$Student.Achievement.Rating)
accuracy.aic = mean(glm.aic.pred == test$Student.Achievement.Rating)
mce.aic = mean(glm.aic.pred != test$Student.Achievement.Rating)

#Logistic Ridge
X.test = test
X.test$Student.Achievement.Rating = NULL
X.test$School.Name = NULL
y.test = test$Student.Achievement.Rating
x.test = model.matrix( ~ ., X.test)


glm.ridge.prob <- predict(glm.ridge, s = 4, newx = x.test)
glm.ridge.pred <- rep("Not Meeting Target", 138)
glm.ridge.pred[glm.ridge.prob > 0.5] <- "Meeting Target"
cm.ridge = table(glm.ridge.pred,test$Student.Achievement.Rating)
accuracy.ridge = mean(glm.ridge.pred == test$Student.Achievement.Rating)
mce.ridge = mean(glm.ridge.pred != test$Student.Achievement.Rating)

#Logistic Lasso
glm.lasso.prob <- predict(glm.lasso, s = 4, newx = x.test)
glm.lasso.pred <- rep("Not Meeting Target", 138)
glm.lasso.pred[glm.lasso.prob > 0.5] <- "Meeting Target"
cm.lasso = table(glm.lasso.pred,test$Student.Achievement.Rating)
accuracy.lasso = mean(glm.lasso.pred == test$Student.Achievement.Rating)
mce.lasso = mean(glm.lasso.pred != test$Student.Achievement.Rating)

# Random Forest
print(rf)
accuracy.rf = 1-.326
mce.rf = .326

summary(glm.full)
summary(glm.aic)
glm.lasso.coef

#SVM
#Tuning for radial
set.seed(2234)
bestcost.radial<- tune(svm, Student.Achievement.Rating ~ ., data = train, kernel = "radial", ranges = list(cost = seq(.01, 10, by = 0.1)))
summary(bestcost.radial)

#New radial svm with tuned cost
svm.radial.bestcost <- svm(Student.Achievement.Rating ~ ., kernel = "radial", data = train, cost = bestcost.radial$best.parameter$cost)
summary(svm.radial.bestcost)

test.pred.radial.bestcost <- predict(svm.radial.bestcost, test)
table(test$Student.Achievement.Rating, test.pred.radial.bestcost)

accuracy.svm = 1-(12+34)/(12+34+22+71)
mce.svm = (12+34)/(12+34+22+71)
```

```{r, echo = FALSE}
#Tabulating Results
Model <- c("Logit Full Model", "Logit AIC", "Logit Ridge", "Logit Lasso", "Random Forest", "RBF SVM")  # vector containing names of models

MCE <- c(mce.full, mce.aic, mce.ridge, mce.lasso, mce.rf, mce.svm)
Accuracy <- c(accuracy.full, accuracy.aic, accuracy.ridge, accuracy.lasso, accuracy.rf, accuracy.svm)

metrics <- data.frame(Model, MCE, Accuracy) 

knitr::kable(metrics, digits = 5) 
cm.ridge
```

I chose the ridge-regularized logit regression because (1) prediction accuracy is fair (2) my prior belief is that all covariates have some impact on the response and (3) ridge regularization handles the collinearity which inflated variance for the ordinary logit. The confusion matrix demonstrates that my model performs fairly, but needs improvement. 

```{r, include=FALSE}
data.multi$Enrollment = as.numeric(data.multi$Enrollment)
data.multi$Instruction.Rating.pct = as.numeric(data.multi$Instruction.Rating.pct)
data.multi$Teachers.Rating.pct = as.numeric(data.multi$Teachers.Rating.pct)
data.multi$Supportive.Environment.pct = as.numeric(data.multi$Supportive.Environment.pct)
data.multi$Leadership.Rating.pct = as.numeric(data.multi$Leadership.Rating.pct)
data.multi$Community.Ties.Rating.pct = as.numeric(data.multi$Community.Ties.Rating.pct)
data.multi$Trust...Percent.Positive = as.numeric(data.multi$Trust...Percent.Positive)
data.multi$ELA.Proficiency = as.numeric(data.multi$Math.Proficiency)
data.multi$Percent.English.Language.Learners = as.numeric(data.multi$Percent.English.Language.Learners)
data.multi$Percent.Students.with.Disabilities = as.numeric(data.multi$Percent.Students.with.Disabilities)
data.multi$Percent.Self.Contained = as.numeric(data.multi$Percent.Self.Contained)
data.multi$Economic.Need.Index = as.numeric(data.multi$Economic.Need.Index)
data.multi$Percent.Overage..Undercredited = as.numeric(data.multi$Percent.Overage..Undercredited)
data.multi$percent_in_temp_housing = as.numeric(data.multi$percent_in_temp_housing)
data.multi$percent_hra_eligible = as.numeric(data.multi$percent_hra_eligible)
data.multi$Percent.Asian = as.numeric(data.multi$Percent.Asian)
data.multi$Percent.Black = as.numeric(data.multi$Percent.Black)
data.multi$Percent.Hispanic = as.numeric(data.multi$Percent.Hispanic)
data.multi$Principal.Experience.yrs = as.numeric(data.multi$Principal.Experience.yrs)
data.multi$Teachers.3yrs.Experience = as.numeric(data.multi$Teachers.3yrs.Experience)
data.multi$Student.Attendance.Rate = as.numeric(data.multi$Student.Attendance.Rate)
data.multi$Students.Chronically.Absent = as.numeric(data.multi$Students.Chronically.Absent)
data.multi$Student.Attendance.Rate = as.numeric(data.multi$Student.Attendance.Rate)
data.multi$Students.Chronically.Absent = as.numeric(data.multi$Students.Chronically.Absent)
data.multi$Teacher.Attendance.Rate = as.numeric(data.multi$Teacher.Attendance.Rate)
data.multi$Percent.White = as.numeric(data.multi$Percent.White)

#Removing Covariates
redundant_cols = c("Instruction.Rating", "Supportive.Environment.Rating", "Community.Ties.Rating", "Teachers.Rating", "Leadership.Rating", "Trust.Rating", "dbn", "percent_hra_eligible", "Effective.Teaching.qr", "Expectations.Communicated.qr", "Safe.Inclusive.qr", "Meet.Goals.qr", "Decisions.Evaluated.qr", "Challenging.Curriculum.qr", "School.Assess.qr", "Teachers.Cooperation.qr", "Resource.Allocation.qr", "Teacher.Development.qr", "Review.Dates.qr", "Students.Chronically.Absent", "percent_in_temp_housing", "school_type", "ELA.Proficiency", "Math.Proficiency", "school_name", "supportive_environment_rating", "trust_rating")
data.multi = data.multi[ , -which(names(data.multi) %in% redundant_cols)]

missing.prop.multi <- apply(data.multi, MARGIN = 2, FUN = function(x) { sum(is.na(x)) })
missing.prop.multi <- missing.prop.multi / dim(data.multi)[1]
missing.prop.multi <- data.frame("prop" = missing.prop.multi,
                           "var" = names(data.multi))

impute_covariates.multi <- as.character(missing.prop.multi[(missing.prop.multi$prop <= 0.05) & (missing.prop.multi$prop > 0), ]$var)
data.multi.2 <- as.data.frame(data.multi)
for (var in impute_covariates.multi) {
  print(var)
  if (is.factor(data.multi.2[[var]])) {
    data.multi.2[is.na(data.multi.2[[var]]), var] <- calc.mode(data.multi.2[[var]])
  } else {
    data.multi.2[is.na(data.multi.2[[var]]), var] <- mean(data.multi.2[[var]], na.rm = TRUE)
  }
}

#Mice
init.multi = mice(data.multi.2, maxit=0) 
meth.multi = init.multi$method
predM.multi = init.multi$predictorMatrix
meth.multi[c("Student.Achievement.Rating")]="polyreg" 
data.multi.3 <- mice(data.multi.2, m=4, method=meth.multi, predictorMatrix=predM.multi, maxit = 5)

data.multi.5 <- complete(data.multi.3)

multi.full <- polr(Student.Achievement.Rating ~ ., data = data.multi.5, Hess=TRUE)


#Ridge and Lasso
X.train.multi = train
X.train.multi$Student.Achievement.Rating = NULL
X.train.multi$School.Name = NULL
y.train.multi = train$Student.Achievement.Rating
x.train.multi = model.matrix( ~ ., X.train)

#Ridge
set.seed(15)
cv.out.multi <- cv.glmnet(x.train.multi, y.train.multi, alpha = 0, family = "multinomial")
bestlamridge.multi <- cv.out.multi$lambda.min
bestlamridge.multi

multi.ridge <-glmnet(x = x.train, y = y.train, alpha = 0, lambda = bestlamridge.multi, family = "multinomial" )
multi.ridge.coef = coef(multi.ridge)

summary(multi.full)
summary(glm.full)

#Penalized
# install.packages("devtools")
# require(devtools)
# install_github("jshinb/pmlr")
# library(pmlr)
# 
# multi.penalized = pmlr(Student.Achievement.Rating ~ ., data = data.multi.5)

aic.multi = 818.85
rd.multi = 770.85
aic.glm = 344.49
rd.glm = 302.49

Residual_Deviance <- c(rd.glm, rd.multi)
AIC_Score <- c(aic.glm, aic.multi)
Model <- c("Ordinary Logistic", "Multinomial Logistic")

metrics.multi <- data.frame(Model, Residual_Deviance, AIC_Score) 

multi.table = knitr::kable(metrics.multi, digits = 5) 
```

```{r, include = FALSE}
# #SMOTE
# newData <- SMOTE(Student.Achievement.Rating ~ ., data = data5, perc.over = 200, perc.under=200)
# table(newData$Species)
# 
# ## Checking visually the created data
# ## Not run: 
# # par(mfrow = c(1, 2))
# # plot(data[, 1], data[, 2], pch = 19 + as.integer(data[, 3]),
# #      main = "Original Data")
# # plot(newData[, 1], newData[, 2], pch = 19 + as.integer(newData[,3]),
# #      main = "SMOTE'd Data")
# # ## End(Not run)
# 
# ## Now an example where we obtain a model with the "balanced" data
# classTree <- SMOTE(Species ~ ., data, perc.over = 600,perc.under=100,
#                    learner='rpartXse',se=0.5)
# ## check the resulting classification tree
# classTree
```

```{r, include = FALSE}
#Manipulating Ridge
tmp_coeffs <- coef(glm.ridge, s = "bestlamridge")
glm.ridge.coef = data.frame(name = tmp_coeffs@Dimnames[[1]][tmp_coeffs@i + 1], coefficient = tmp_coeffs@x)

glm.ridge.coef = as.data.frame(t(glm.ridge.coef)) 
colnames(glm.ridge.coef) <- as.character(unlist(glm.ridge.coef[1,]))
glm.ridge.coef = glm.ridge.coef[-1, ]

glm.ridge.coef[] <- lapply(glm.ridge.coef, function(x) {
    if(is.factor(x)) as.numeric(as.character(x)) else x
})

glm.ridge.coef$Intercept = glm.ridge.coef[,1]
```

```{r, include = FALSE}
#Manipulating Lasso
tmp_coeffs <- coef(glm.lasso, s = "bestlamlasso")
glm.lasso.coef = data.frame(name = tmp_coeffs@Dimnames[[1]][tmp_coeffs@i + 1], coefficient = tmp_coeffs@x)

glm.lasso.coef = as.data.frame(t(glm.lasso.coef)) 
colnames(glm.lasso.coef) <- as.character(unlist(glm.lasso.coef[1,]))
glm.lasso.coef = glm.lasso.coef[-1, ]

glm.lasso.coef[] <- lapply(glm.lasso.coef, function(x) {
    if(is.factor(x)) as.numeric(as.character(x)) else x
})

glm.lasso.coef$Intercept = glm.lasso.coef[,1]
```


### 4. Results
```{r,include = FALSE}
glm.ridge.coef.odds = exp(1)^coef(glm.ridge)
glm.ridge.coef.odds
```

My model yielded several surprising results. A 1% ratings increase in teacher approval, community ties, trust, and teacher experience decreased a school's odds of meeting a target by multiplicative factors of .57, .35, 34, and .39, respectively. I posit several hypotheses. First, students approve of easier teachers who don't prepare their students well for exams. My mother, an accounting professor with a famously low student approval rating, actually sees a large proportion of her students getting CPA-certified. Second, students that are more competitive and thus high-performing are most likely to be less trusting by nature. Third, teachers are getting outdated as assessment types are beginning to evaluate fundamentally different student abilities. Finally, schools and their communities may have conflicts of interest. My school district dumbed down the curriculum in response to parent complaints about stress, which lowered the school quality. 

However, on the whole, my model results are in line with accepted pedagogical doctrine. Increasing the Asian, Black, Hispanic, and White composition by 1% changes the odds of a school meeting a target by a multiplicative factor of 6.79, .42, 1.83, and .35, respectively. Overcrowded schools marginally harms its performance; every additional student decreases the odds of a school meeting a target by .01. On student composition, a 1% increase in ESL and Economic Need Index changed the school's odds of meeting a target by multiplicative factors of .28 and .29, respectively. On the subjective metrics, a 1% ratings increase in curriculum, environment supportiveness, and leadership increases the school's odds of meeting a target by factors of 252, 553, and 1.4. Finally, a 1% increase in student and teacher attendance rate increases a school's odds of meeting a target by 21,724 and 2,526,725,418, respectively. 

Find my R Shiny visualization of my results here (run the rmd to the bottom): https://github.com/alj47/STA440-Individual-CS/blob/master/Austin%20Jia%20Interim%202%20Final.Rmd

### 5. Conclusions

My results demonstrate that some areas most popularly believed to improve school performance may actually have adverse effects, such as fostering teacher popularity and community ties. Instead, policymakers should hold more conferences for the purpose of building more rigorous curriculum and find ways to incentivze attendance rate (i.e. making graduation or extracurricular participation contingent on a higher attendance rate minimum).

The main limitaiton of my analysis relates to scope. As the data only sampled 485 NYC high schools, my results should not be extrapolated to schools outside of NYC or even the NYC K-8 school systems. If given more time, a next step would be to bind the NYC Open Data K-12 database that I just discovered several days ago to allow my analysis to address educational factors that impact the entire K-12 system in NYC. 

I also explored a proportional odds logistic regression model to model the original four student achivement rating categories. While I originally tailored my analysis around the binary world that my connection described, this model could be useful in the event that the NYC DOE budget shrinks to only be able to provide for those 39 schools at the bottom of the barrel. A next step could be to explore the Synthetic Minority Over-sampling Technique (SMOTE) to address the deviance created by imbalanced classes (showcased in the table below). 

```{r, echo=FALSE}
multi.table
```

```{r, include = FALSE}
#Function to display probability
logit2prob <- function(logit){
  odds <- exp(logit)
  prob <- odds / (1 + odds)
  return(prob)
}
```

```{r, include = FALSE}
# Shiny Visualization 

ui = fluidPage(
  title = "NYC High School Performance",
  titlePanel("NYC High School Performance"),
  sidebarLayout(
    sidebarPanel = sidebarPanel(
      h4("Viewable Statistics"),
      helpText("View how changing school parameters affects whether it does or doesn't meet standards"),
      selectInput("selection", "Select something", choices = c("School Size", "Teachers Rating", "Supportive Environment", "Leadership", "Community Ties", "Trust", "Percent English Language Learners", "Percent Students with Disabilities", "Percent Self-Contained Classrooms", "Percent Undercredited" , "Race - Asian", "Race - Black", "Race - Hispanic", "Race - White","Economic Need Index", "Principal Experience", "Instruction Rating", "Student Attendance Rate", "Teacher Attendance Rate")),
      conditionalPanel(
        "input.selection == 'School Size'",
        sliderInput("slider_enrollment", "Enrollment", min = min(data5$Enrollment), max = max(data5$Enrollment), value = 100, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Race - Asian'",
        sliderInput("slider_asian", "Asian Percentage", min = min(data5$Percent.Asian), max = max(data5$Percent.Asian), value = 50, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Race - Black'",
        sliderInput("slider_black", "Black Percentage", min = min(data5$Percent.Black), max = max(data5$Percent.Black), value = 50, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Economic Need Index'",
        sliderInput("slider_economic", "Economic Need Index", min = min(data5$Economic.Need.Index), max = max(data5$Economic.Need.Index), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Principal Experience'",
        sliderInput("slider_principal", "Principal Experience", min = min(data5$Principal.Experience.yrs), max = max(data5$Principal.Experience.yrs), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Instruction Rating'",
        sliderInput("slider_instruction", "Percent Approval of Instruction", min = min(data5$Instruction.Rating.pct), max = max(data5$Instruction.Rating.pct), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Teachers Rating'",
        sliderInput("slider_teachers", "Percent Approval of Teachers", min = min(data5$Teachers.Rating.pct), max = max(data5$Teachers.Rating.pct), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Supportive Environment'",
        sliderInput("slider_supportive", "Percent Approval that School Environment is Supportive", min = min(data5$Supportive.Environment.pct), max = max(data5$Supportive.Environment.pct), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Leadership'",
        sliderInput("slider_leadership", "Percent Approval of Leadership in School", min = min(data5$Leadership.Rating.pct), max = max(data5$Leadership.Rating.pct), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Community Ties'",
        sliderInput("slider_community", "Percent Belief that school has strong community ties", min = min(data5$Community.Ties.Rating.pct), max = max(data5$Community.Ties.Rating.pct), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Trust'",
        sliderInput("slider_trust", "Percent Approval in Trust of School", min = min(data5$Trust...Percent.Positive), max = max(data5$Trust...Percent.Positive), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Percent English Language Learners'",
        sliderInput("slider_esl", "Percent English Language Learners", min = min(data5$Percent.English.Language.Learners), max = max(data5$Percent.English.Language.Learners), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Percent Students with Disabilities'",
        sliderInput("slider_swd", "Percent Students with Disabilities", min = min(data5$Percent.Students.with.Disabilities), max = max(data5$Percent.Students.with.Disabilities), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Percent Self-Contained Classrooms'",
        sliderInput("slider_selfcontained", "Percent Self-Contained Classrooms", min = min(data5$Trust...Percent.Positive), max = max(data5$Trust...Percent.Positive), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Percent Undercredited'",
        sliderInput("slider_undercredited", "Percent Undercredited", min = min(data5$Percent.Overage..Undercredited), max = max(data5$Percent.Overage..Undercredited), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Race - Hispanic'",
        sliderInput("slider_hispanic", "Percent Hispanic", min = min(data5$Percent.Hispanic), max = max(data5$Percent.Hispanic), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Race - White'",
        sliderInput("slider_white", "Percent White", min = min(data5$Percent.White), max = max(data5$Percent.White), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Student Attendance Rate'",
        sliderInput("slider_studentattendance", "Student Attendance Rate", min = min(data5$Student.Attendance.Rate), max = max(data5$Student.Attendance.Rate), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Teacher Attendance Rate'",
        sliderInput("slider_teacherattendance", "Teacher Attendance Rate", min = min(data5$Trust...Percent.Positive), max = max(data5$Trust...Percent.Positive), value = .5, ticks = FALSE)
      )
    ),
    mainPanel = mainPanel(
      textOutput("selected_var"),
      conditionalPanel(
        condition = "input.selection == 'School Size'",
        textOutput("probability_enrollment")
      ),
      conditionalPanel(
        condition = "input.selection == 'Race - Asian'",
        textOutput("probability_asian")
      ),
      conditionalPanel(
        condition = "input.selection == 'Race - Black'",
        textOutput("probability_black")
      ),
      conditionalPanel(
        condition = "input.selection == 'Principal Experience'",
        textOutput("probability_principal")
      ),
      conditionalPanel(
        condition = "input.selection == 'Economic Need Index'",
        textOutput("probability_economic")
      ),
      conditionalPanel(
        condition = "input.selection == 'Instruction Rating'",
        textOutput("probability_instruction")
      ),
      conditionalPanel(
        condition = "input.selection == 'Teachers Rating'",
        textOutput("probability_teachers")
      ),
      conditionalPanel(
        condition = "input.selection == 'Supportive Environment'",
        textOutput("probability_supportive")
      ),
      conditionalPanel(
        condition = "input.selection == 'Leadership'",
        textOutput("probability_leadership")
      ),
      conditionalPanel(
        condition = "input.selection == 'Community Ties'",
        textOutput("probability_community")
      ),
      conditionalPanel(
        condition = "input.selection == 'Trust'",
        textOutput("probability_trust")
      ),
      conditionalPanel(
        condition = "input.selection == 'Percent English Language Learners'",
        textOutput("probability_esl")
      ),
      conditionalPanel(
        condition = "input.selection == 'Percent Students with Disabilities'",
        textOutput("probability_swd")
      ),
      conditionalPanel(
        condition = "input.selection == 'Percent Self-Contained Classrooms'",
        textOutput("probability_selfcontained")
      ),
      conditionalPanel(
        condition = "input.selection == 'Percent Undercredited'",
        textOutput("probability_undercredited")
      ),
      conditionalPanel(
        condition = "input.selection == 'Race - Hispanic'",
        textOutput("probability_hispanic")
      ),
      conditionalPanel(
        condition = "input.selection == 'Race - White'",
        textOutput("probability_white")
      ),
      conditionalPanel(
        condition = "input.selection == 'Student Attendance Rate'",
        textOutput("probability_studentattendance")
      ),
      conditionalPanel(
        condition = "input.selection == 'Teacher Attendance Rate'",
        textOutput("probability_teacherattendance")
      ),
      conditionalPanel(
        condition = "input.selection == 'School Size'",
        plotOutput("enrollment_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Race - Asian'",
        plotOutput("asian_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Race - Black'",
        plotOutput("black_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Principal Experience'",
        plotOutput("principal_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Economic Need Index'",
        plotOutput("economic_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Instruction Rating'",
        plotOutput("instruction_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Teachers Rating'",
        plotOutput("teachers_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Supportive Environment'",
        plotOutput("supportive_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Leadership'",
        plotOutput("leadership_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Community Ties'",
        plotOutput("community_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Trust'",
        plotOutput("trust_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Percent English Language Learners'",
        plotOutput("esl_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Percent Students with Disabilities'",
        plotOutput("swd_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Percent Self-Contained Classrooms'",
        plotOutput("selfcontained_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Percent Undercredited'",
        plotOutput("undercredited_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Race - Hispanic'",
        plotOutput("hispanic_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Race - White'",
        plotOutput("white_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Student Attendance Rate'",
        plotOutput("studentattendance_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Teacher Attendance Rate'",
        plotOutput("teacherattendance_plot")
      ),
      textOutput("plot_explanation")
    )
  )
)

server = function(input, output) {
  output$selected_var <- renderText({ 
    paste("You have selected", input$selection)
  })
  output$probability_enrollment <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_enrollment * glm.ridge.coef$Enrollment[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_asian <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_asian * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Enrollment) * glm.ridge.coef$Enrollment[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_black <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$black * glm.ridge.coef$black[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Enrollment)*glm.ridge.coef$Percent.Enrollment[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_principal <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_principal * glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_economic <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_economic * glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_instruction <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_instruction * glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_teachers <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_teachers*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Enrollment) * glm.ridge.coef$Enrollment[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] +  mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_supportive <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_supportive * glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_leadership <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_leadership * glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_community <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_community * glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_trust <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_trust * glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_esl <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_esl * glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_swd <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_swd * glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_selfcontained <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_selfcontained * glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_undercredited <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_undercredited * glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_hispanic <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_hispanic * glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_white <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_white * glm.ridge.coef$Percent.White[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_studentattendance <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_studentattendance * glm.ridge.coef$Student.Attendance.Rate[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]]), 3)) 
  })
  output$probability_teacherattendance <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_teacherattendance * glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$enrollment_plot <- renderPlot(p_enrollment + geom_vline(aes(xintercept = input$slider_enrollment), colour = "blue", size = 1))
  output$asian_plot <- renderPlot(p_asian + geom_vline(aes(xintercept = input$slider_asian), colour = "blue", size = 1))
  output$black_plot <- renderPlot(p_black + geom_vline(aes(xintercept = input$slider_black), colour = "blue", size = 1))
  output$principal_plot <- renderPlot(p_principal_exp + geom_vline(aes(xintercept = input$slider_principal), colour = "blue", size = 1))
  output$economic_plot <- renderPlot(p_econ + geom_vline(aes(xintercept = input$slider_economic), colour = "blue", size = 1))
  output$instruction_plot <- renderPlot(p_instruction_rating + geom_vline(aes(xintercept = input$slider_instruction), colour = "blue", size = 1))
  output$teachers_plot <- renderPlot(p_teachers + geom_vline(aes(xintercept = input$slider_teachers), colour = "blue", size = 1))
  output$supportive_plot <- renderPlot(p_supportive + geom_vline(aes(xintercept = input$slider_supportive), colour = "blue", size = 1))
  output$leadership_plot <- renderPlot(p_leadership + geom_vline(aes(xintercept = input$slider_leadership), colour = "blue", size = 1))
  output$community_plot <- renderPlot(p_community + geom_vline(aes(xintercept = input$slider_community), colour = "blue", size = 1))
  output$trust_plot <- renderPlot(p_trust + geom_vline(aes(xintercept = input$slider_trust), colour = "blue", size = 1))
  output$esl_plot <- renderPlot(p_esl + geom_vline(aes(xintercept = input$slider_esl), colour = "blue", size = 1))
  output$swd_plot <- renderPlot(p_swd + geom_vline(aes(xintercept = input$slider_swd), colour = "blue", size = 1))
  output$selfcontained_plot <- renderPlot(p_selfcontained + geom_vline(aes(xintercept = input$slider_selfcontained), colour = "blue", size = 1))
  output$undercredited_plot <- renderPlot(p_undercredited + geom_vline(aes(xintercept = input$slider_undercredited), colour = "blue", size = 1))
  output$hispanic_plot <- renderPlot(p_hispanic + geom_vline(aes(xintercept = input$slider_hispanic), colour = "blue", size = 1))
  output$white_plot <- renderPlot(p_white + geom_vline(aes(xintercept = input$slider_white), colour = "blue", size = 1))
  output$studentattendance_plot <- renderPlot(p_studentattendance + geom_vline(aes(xintercept = input$slider_studentattendance), colour = "blue", size = 1))
  output$teacherattendance_plot <- renderPlot(p_teacherattendance + geom_vline(aes(xintercept = input$slider_teacherattendance), colour = "blue", size = 1))
  output$plot_explanation <- renderText({
    paste("This plot compares the distribution of schools that have met versus not met the target with respect to the parameter chosen. The blue vertical line indicates the parameter level that you have indicated.")
  })
}

shinyApp(ui = ui, server = server)
```

